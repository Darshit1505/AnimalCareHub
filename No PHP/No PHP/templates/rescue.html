{% extends "base.html" %}
{% set page_active = 'rescue' %}
{% block body_class %}rescue-page form-page{% endblock %}

{% block title %}Report Animal Sighting - Pet's Paalan{% endblock %}

{% block head %}
    {{ super() }}
    <style>
        .rescue-image { object-fit: cover; height: 100%; max-height: 550px; }
    </style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center align-items-center g-lg-5">

        {# Column 1: Image and Text #}
        <div class="col-lg-5 text-center text-lg-start mb-5 mb-lg-0">
            <h1 class="display-5 fw-bold lh-1 mb-3 text-warning"><i class="fas fa-first-aid me-2"></i>Report an Animal in Need</h1>
            <p class="lead text-muted mb-4">
                Your eyes on the ground can save a life. If you see an animal that appears lost, injured, neglected, or in danger,
                please let us know by filling out this form.
            </p>
             {# *** REPLACE IMAGE PATH *** #}
            <img src="{{ url_for('static', filename='image/rescue-street.jpg') }}" alt="Stray dog looking hopefully" class="img-fluid rounded shadow-lg rescue-image">
             <p class="small text-danger mt-3"><i class="fas fa-exclamation-triangle me-1"></i> For immediate, life-threatening emergencies, please contact local animal control or police first.</p>
        </div>

        {# Column 2: Rescue Form #}
        <div class="col-lg-7 col-xl-6">
             <div class="form-container-wrapper">
                <div class="form-container card shadow-sm">
                     <div class="card-body p-4 p-lg-5">
                        <h2 class="h4 mb-4 text-center">Animal Sighting Details</h2>
                         {# Flash messages handled in base.html #}

                        <form id="rescueForm" method="POST" action="{{ url_for('rescue_page') }}" enctype="multipart/form-data">
                            <div class="mb-3">
                                <label for="animalType" class="form-label">Animal Type Seen:</label>
                                <select class="form-select form-select-sm" id="animalType" name="animalType" required>
                                    <option value="" disabled {% if not form_data or not form_data.animalType %}selected{% endif %}>-- Select --</option>
                                    <option value="Dog" {% if form_data and form_data.animalType == 'Dog' %}selected{% endif %}>Dog</option>
                                    <option value="Cat" {% if form_data and form_data.animalType == 'Cat' %}selected{% endif %}>Cat</option>
                                    <option value="Bird" {% if form_data and form_data.animalType == 'Bird' %}selected{% endif %}>Bird</option>
                                    <option value="Other" {% if form_data and form_data.animalType == 'Other' %}selected{% endif %}>Other</option>
                                </select>
                            </div>
                            <div class="mb-3" id="otherAnimalTypeGroup" style="display: none;">
                                <label for="otherAnimalType" class="form-label">Specify Other Type:</label>
                                <input type="text" class="form-control form-control-sm" id="otherAnimalType" name="otherAnimalType" placeholder="E.g., Rabbit, Cow" value="{{ form_data.otherAnimalType if form_data else '' }}">
                            </div>
                            <div class="mb-3">
                                <label for="location" class="form-label">Location Animal Was Seen:</label>
                                <input type="text" class="form-control form-control-sm" id="location" name="location" placeholder="Street, cross-streets, landmark..." required value="{{ form_data.location if form_data else '' }}">
                                 <div class="form-text small">Please be as specific as possible.</div>
                            </div>
                            {# Optional: Add condition/details field #}
                             <div class="mb-3">
                                 <label for="conditionDetails" class="form-label">Condition/Details <small class="text-muted">(Optional)</small></label>
                                 <textarea class="form-control form-control-sm" id="conditionDetails" name="condition_details" rows="3" placeholder="e.g., Limping, very thin, seems lost, trapped...">{{ form_data.condition_details if form_data else '' }}</textarea>
                             </div>
                            <div class="mb-3">
                                <label for="animalImage" class="form-label">Upload Photo <small class="text-muted">(If possible & safe)</small>:</label>
                                <input type="file" class="form-control form-control-sm" id="animalImage" name="animalImage" accept="image/png, image/jpeg, image/gif" required>
                                 <div class="form-text small">A photo helps us identify and assess the situation.</div>
                            </div>
                            <button type="submit" class="btn btn-warning w-100 mt-3">Submit Report</button>
                        </form>
                     </div>
                </div>
             </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    {# JS to show/hide 'Other' field #}
    <script>
        document.getElementById('animalType').addEventListener('change', function() {
            const otherAnimalTypeGroup = document.getElementById('otherAnimalTypeGroup');
            const otherInput = document.getElementById('otherAnimalType');
            if (this.value === 'Other') {
                otherAnimalTypeGroup.style.display = 'block'; otherInput.required = true;
            } else {
                otherAnimalTypeGroup.style.display = 'none'; otherInput.required = false; otherInput.value = '';
            }
        });
        document.addEventListener('DOMContentLoaded', function() {
            const animalTypeSelect = document.getElementById('animalType');
            if (animalTypeSelect) { animalTypeSelect.dispatchEvent(new Event('change')); }
        });
    </script>
{% endblock %}